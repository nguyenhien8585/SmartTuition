# File máº«u GitHub Actions Ä‘á»ƒ tá»± Ä‘á»™ng backup (nÃ¢ng cao)
# Äá»•i tÃªn file nÃ y thÃ nh auto-backup.yml Ä‘á»ƒ kÃ­ch hoáº¡t

name: Auto Backup Reminder

on:
  schedule:
    # Cháº¡y lÃºc 9 giá» sÃ¡ng má»—i Chá»§ nháº­t (UTC+0, cá»™ng 7 tiáº¿ng = 16h VN)
    - cron: '0 9 * * 0'
  
  # Cho phÃ©p cháº¡y thá»§ cÃ´ng
  workflow_dispatch:

jobs:
  backup-reminder:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check if backup file exists
        id: check_backup
        run: |
          if [ -f "data/tuition_backup.json" ]; then
            echo "Backup file exists"
            echo "exists=true" >> $GITHUB_OUTPUT
          else
            echo "Backup file not found"
            echo "exists=false" >> $GITHUB_OUTPUT
          fi
        continue-on-error: true
      
      - name: Get last backup time
        if: steps.check_backup.outputs.exists == 'true'
        run: |
          echo "Last backup: $(git log -1 --format=%cd data/tuition_backup.json || echo 'Never')"
      
      - name: Create Issue reminder
        uses: actions/github-script@v6
        with:
          script: |
            const now = new Date();
            const title = `ğŸ“Œ Nháº¯c nhá»Ÿ: Backup dá»¯ liá»‡u há»c phÃ­ - ${now.toLocaleDateString('vi-VN')}`;
            const body = `
            ## ğŸ‘‹ Xin chÃ o!
            
            ÄÃ¢y lÃ  nháº¯c nhá»Ÿ tá»± Ä‘á»™ng Ä‘á»ƒ backup dá»¯ liá»‡u há»c phÃ­ cá»§a báº¡n.
            
            ### âœ… HÃ nh Ä‘á»™ng cáº§n lÃ m:
            1. Má»Ÿ á»©ng dá»¥ng SmartTuition
            2. VÃ o tab **Cáº¥u HÃ¬nh**
            3. Click nÃºt **"LÆ°u lÃªn GitHub"**
            4. Kiá»ƒm tra thÃ´ng bÃ¡o thÃ nh cÃ´ng
            5. ÄÃ³ng issue nÃ y sau khi hoÃ n thÃ nh
            
            ### ğŸ“Š Thá»‘ng kÃª:
            - NgÃ y táº¡o issue: ${now.toLocaleString('vi-VN')}
            - Ká»³ backup: HÃ ng tuáº§n
            
            ---
            _Issue nÃ y Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng bá»Ÿi GitHub Actions_
            `;
            
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['reminder', 'backup']
            });
